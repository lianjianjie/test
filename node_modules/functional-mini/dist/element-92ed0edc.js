import{l as e,y as n,k as t,G as o,T as r,p as a,F as i,h as c,_ as s,s as l,q as u,v as f,D as d}from"./hooks-a6626ffa.js";var p=/[\s\n\\/='"\0<>]/,h=/^xlink:?./,m=/["&<]/;function v(e){if(0===e.length||!1===m.test(e))return e;for(var n=0,t=0,o="",r="";t<e.length;t++){switch(e.charCodeAt(t)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 60:r="&lt;";break;default:continue}t!==n&&(o+=e.slice(n,t)),o+=r,n=t+1}return t!==n&&(o+=e.slice(n,t)),o}var g={},y=new Set(["animation-iteration-count","border-image-outset","border-image-slice","border-image-width","box-flex","box-flex-group","box-ordinal-group","column-count","fill-opacity","flex","flex-grow","flex-negative","flex-order","flex-positive","flex-shrink","flood-opacity","font-weight","grid-column","grid-row","line-clamp","line-height","opacity","order","orphans","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-miterlimit","stroke-opacity","stroke-width","tab-size","widows","z-index","zoom"]),_=/[A-Z]/g;function w(e){var n="";for(var t in e){var o=e[t];if(null!=o&&""!==o){var r="-"==t[0]?t:g[t]||(g[t]=t.replace(_,"-$&").toLowerCase()),a=";";"number"!=typeof o||r.startsWith("--")||y.has(r)||(a="px;"),n=n+r+":"+o+a}}return n||void 0}var b,x,k,I,C=[],E=Array.isArray,O=Object.assign;function T(){this.__d=!0}var P={};function L(e,n){var t,o=e.type,r=!0;return e.__c?(r=!1,(t=e.__c).state=t.__s):t=new o(e.props,n),e.__c=t,t.__v=e,t.props=e.props,t.context=n,t.__d=!0,null==t.state&&(t.state=P),null==t.__s&&(t.__s=t.state),o.getDerivedStateFromProps?t.state=O({},t.state,o.getDerivedStateFromProps(t.props,t.state)):r&&t.componentWillMount?(t.componentWillMount(),t.state=t.__s!==t.state?t.__s:t.state):!r&&t.componentWillUpdate&&t.componentWillUpdate(),k&&k(e),t.render(t.props,t.state,n)}function N(n,o,r,a,i){if(null==n||!0===n||!1===n||""===n)return"";if("object"!=typeof n)return"function"==typeof n?"":v(n+"");if(E(n)){var c="";i.__k=n;for(var s=0;s<n.length;s++){var l=n[s];null!=l&&"boolean"!=typeof l&&(c+=N(l,o,r,a,i))}return c}if(void 0!==n.constructor)return"";n.__=i,b&&b(n);var u,f,d,m=n.type,g=n.props,y=o;if("function"==typeof m){if(m===t){if(g.UNSTABLE_comment)return"\x3c!--"+v(g.UNSTABLE_comment||"")+"--\x3e";f=g.children}else{if(null!=(u=m.contextType)){var _=o[u.__c];y=_?_.props.value:u.__}if(m.prototype&&"function"==typeof m.prototype.render)f=L(n,y),d=n.__c;else{n.__c=d={__v:n,props:g,context:y,setState:T,forceUpdate:T,__d:!0,__h:[]};for(var C=0;d.__d&&C++<25;)d.__d=!1,k&&k(n),f=m.call(d,g,y);d.__d=!0}if(null!=d.getChildContext&&(o=O({},o,d.getChildContext())),(m.getDerivedStateFromError||d.componentDidCatch)&&e.errorBoundaries){var P="";f=null!=f&&f.type===t&&null==f.key?f.props.children:f;try{return P=N(f,o,r,a,n)}catch(e){return m.getDerivedStateFromError&&(d.__s=m.getDerivedStateFromError(e)),d.componentDidCatch&&d.componentDidCatch(e,{}),d.__d&&(f=L(n,o),null!=(d=n.__c).getChildContext&&(o=O({},o,d.getChildContext())),P=N(f=null!=f&&f.type===t&&null==f.key?f.props.children:f,o,r,a,n)),P}finally{x&&x(n),n.__=void 0,I&&I(n)}}}var A=N(f=null!=f&&f.type===t&&null==f.key?f.props.children:f,o,r,a,n);return x&&x(n),n.__=void 0,I&&I(n),A}var S,H="<"+m,U="";for(var M in g){var R=g[M];switch(M){case"children":S=R;continue;case"key":case"ref":case"__self":case"__source":continue;case"htmlFor":if("for"in g)continue;M="for";break;case"className":if("class"in g)continue;M="class";break;case"defaultChecked":M="checked";break;case"defaultSelected":M="selected";break;case"defaultValue":case"value":switch(M="value",m){case"textarea":S=R;continue;case"select":a=R;continue;case"option":a!=R||"selected"in g||(H+=" selected")}break;case"dangerouslySetInnerHTML":U=R&&R.__html;continue;case"style":"object"==typeof R&&(R=w(R));break;default:if(r&&h.test(M))M=M.toLowerCase().replace(j,"xlink:");else{if(p.test(M))continue;"-"!==M[4]&&"draggable"!==M||null==R||(R+="")}}null!=R&&!1!==R&&"function"!=typeof R&&(H=!0===R||""===R?H+" "+M:H+" "+M+'="'+v(R+"")+'"')}if(p.test(m))throw new Error(m+" is not a valid HTML tag name in "+H+">");return U||("string"==typeof S?U=v(S):null!=S&&!1!==S&&!0!==S&&(U=N(S,o,"svg"===m||"foreignObject"!==m&&r,a,n))),x&&x(n),n.__=void 0,I&&I(n),!U&&D.has(m)?H+"/>":H+">"+U+"</"+m+">"}var j=/^xlink:?/,D=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),A=function(o,r){var a=e.__s;e.__s=!0,b=e.__b,x=e.diffed,k=e.__r,I=e.unmount;var i=n(t,null);i.__k=[o];try{return N(o,r||P,!1,void 0,i)}finally{e.__c&&e.__c(o,C),e.__s=a,C.length=0}};var S=function(e){return null!=e&&"function"==typeof e.then},H=0;function U(n){if(++H>1){try{var t=n();if(S(t))return t.then((function(){--H}),(function(e){throw--H,e}))}catch(e){throw--H,e}return--H,Promise.resolve()}var o,r,a=e.requestAnimationFrame,i=(e.t=e.debounceRendering,e.debounceRendering=function(n){return e.o=n},function(){return e.o&&e.o()});e.requestAnimationFrame=function(e){return o=e};var c,s,l=function(){try{for(i();o;)r=o,o=null,r(),i()}catch(e){c||(c=e)}finally{e.o&&(e.o(),delete e.o),void 0!==e.t?(e.debounceRendering=e.t,delete e.t):e.debounceRendering=void 0}e.requestAnimationFrame=a,--H};try{s=n()}catch(e){c=e}if(S(s))return s.then(l,(function(e){throw l(),e}));if(l(),c)throw c;return Promise.resolve()}var M=o,R=n,F=d,B=e,W=r,q=a,V=i,$=c,K=u,z=s,Q=l,G=R;B.requestAnimationFrame=function(e){return setTimeout(e)},B.debounceRendering=function(e){return setTimeout(e)};var Z,J=function(){},Y=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];console.error.apply(console,e)};!function(e){e.VALID="VALID",e.INVALID="INVALID",e.UNKNOWN="UNKNOWN"}(Z||(Z={}));var X=Z.UNKNOWN,ee=function(){return X},ne=0,te="_functional_instance_id_";function oe(e){var n,t;if(!e)throw new Error("appxInstance param is falsy");if(e.$id?t="".concat(e.$id,"-").concat((null===(n=e.$page)||void 0===n?void 0:n.$viewId)||"","-").concat(e.is||"page"):e[te]?t=e[te]:(t="instance-".concat(ne++),e[te]=t),!t)throw new Error("failed to identifiy appxInstance.$id");return t}var re="_functional_instance_prop_names_";function ae(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var t=[],o=0,r=e;o<r.length;o++){var a=r[o];t=t.concat(Object.keys(a))}return t}var ie,ce,se,le=function(){function e(e){void 0===e&&(e=""),this.elementTag="",this.locked=!1,this.executionInProgress=!1,this.executionQueue=[],this.handlerNames=[],this.handlerImpl={},this.elementTag=e}return e.prototype.addHandler=function(e,n,t,o){var r=this;if(this.locked&&this.handlerNames.indexOf(e)<0)throw new Error("不允许动态新增 handler: ".concat(e));if(t&&!n)throw new Error("bindContext 不能为空，运行时需要用到它");if(n&&!t)throw new Error("missing impl");if("string"!=typeof e)throw new Error("name 的类型不合法（".concat(typeof e,"），它应该是一个字符串"));if("function"!=typeof t&&void 0!==t)throw new Error("impl 的类型不合法（".concat(typeof t,"），它应该是一个函数"));this.handlerNames.indexOf(e)<0&&this.handlerNames.push(e),this.handlerImpl[e]=this.handlerImpl[e]||[];var a=this;if(!t)return function(){};if(o&&this.getHandlersByName(e,n).length>0)throw new Error("".concat(e," 已经注册了一个实现，不能再新增"));var i={fn:function(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];if(!this)throw new Error("missing context, cannot find matching handler");if(!a.filterContext(n,this))throw new Error("handler context mismatch, refuse executing");try{var c=t.apply(this,o);if("function"!=typeof c)return c;i.off=c}catch(n){throw Y("".concat(a.elementTag," ").concat(e," 执行出错，错误信息：").concat(n.message)),n}},bindContext:n};return this.handlerImpl[e].push(i),function(){"off ".concat(e," - ").concat(r.elementTag);var n=r.handlerImpl[e];if(!n){var t="没有找到 ".concat(e," 对应的实现，是否已经被 reset 了 ？请检查生命周期流程");throw Y(t),new Error(t)}var o=n.indexOf(i),a=n[o].off;if(a)try{a.call(void 0)}catch(n){throw Y("执行 ".concat(e," 的反注册方法时出错：")),Y(n),n}o>=0&&n.splice(o,1)}},e.prototype.lockHandlerNames=function(){this.locked=!0},e.prototype.resetAllImpl=function(){this.handlerImpl={}},e.prototype.getHandlersByName=function(e,n){var t=this;if(!n)throw new Error("context is required");return this.handlerImpl[e].filter((function(e){return t.filterContext(e.bindContext,n)}))},e.prototype.lockExecution=function(){var e=this,n=function(){if(e.executionInProgress=!1,e.executionQueue.length>0){var n=e.executionQueue.shift();n&&n()}};return this.executionInProgress?new Promise((function(t){e.executionQueue.push((function(){e.executionInProgress=!0,t(n)}))})):(this.executionInProgress=!0,Promise.resolve(n))},e.prototype.callHandlers=function(e,n,t){for(var o,r=this,a=(r.handlerImpl[e]||[]).filter((function(e){return!!r.filterContext(null==e?void 0:e.bindContext,n)})),i="".concat(r.elementTag,"-handlerCalled-").concat(e,"-").concat(Math.floor(1e3*Math.random())),c="".concat(i," - handlers count ").concat(a.length),s=0;s<a.length;s++){Date.now(),"".concat(c," - executing ").concat(s+1,"/").concat(a.length);var l=a[s].fn.apply(n,t);0===s&&(o=l)}return o},e.prototype.getHandlersImplProxy=function(){var e=this;if(!this.locked)throw new Error("please lock the handler names first");var n=this.handlerNames.reduce((function(n,t){var o=e;return n[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r,a;this||console.warn("cannot find appx caller instance");try{a=o.callHandlers(t,this,e)}catch(e){r=e}if(r)throw r;return a},n}),{});return n},e.prototype.filterContext=function(e,n){if("function"==typeof e){if(!e(n))return!1}else if(e!==n)return!1;return n},e}();!function(e){e.alipay="alipay",e.wechat="wechat"}(ie||(ie={})),function(e){e.page="page",e.component="component"}(ce||(ce={}));var ue={onLoad:"onLoad",onShow:"onShow",onReady:"onReady",onHide:"onHide",onPullDownRefresh:"onPullDownRefresh",onReachBottom:"onReachBottom",onShareAppMessage:"onShareAppMessage",onPageScroll:"onPageScroll",onTabItemTap:"onTabItemTap",onResize:"onResize",onUnload:"onUnload"},fe={onTitleClick:"onTitleClick",onOptionMenuClick:"onOptionMenuClick",beforeTabItemTap:"beforeTabItemTap",onKeyboardHeight:"onKeyboardHeight",onBack:"onBack",onSelectedTabItemTap:"onSelectedTabItemTap",beforeReload:"beforeReload"},de={created:"created",attached:"attached",ready:"ready",moved:"moved",detached:"detached"},pe={onInit:"onInit",didMount:"didMount",didUpdate:"didUpdate",deriveDataFromProps:"deriveDataFromProps",didUnmount:"didUnmount"},he=["mixins","methods","observers"],me=((se={})[ie.alipay]={name:ie.alipay,tellIfInThisPlatform:function(){return"undefined"!=typeof my},pageEvents:ae(ue,fe),pageLifeCycleToMount:ue.onLoad,pageLifeCycleToUnmount:ue.onUnload,componentEvents:ae(de,pe),componentLifeCycleToMount:pe.onInit,componentLifeCycleToUnmount:pe.didUnmount,blockedProperty:he,getPropsFromInstance:function(e){return e.props},buildOptions:function(e,n,t,o,r,a){if(void 0===a&&(a=null),e===ce.page)return Object.assign({data:t,options:a},o,r);var i={},c={};return Object.keys(o).forEach((function(e){de[e]?c[e]=o[e]:i[e]=o[e]})),Object.assign({props:n,data:t,options:Object.assign({lifetimes:!0},a||{}),lifetimes:c},i,{methods:r})}},se[ie.wechat]={name:ie.wechat,tellIfInThisPlatform:function(){return"undefined"!=typeof wx},pageEvents:Object.keys(ue),pageLifeCycleToMount:ue.onLoad,pageLifeCycleToUnmount:ue.onUnload,componentEvents:ae(de,{error:"error"}),componentLifeCycleToMount:de.created,componentLifeCycleToUnmount:de.detached,blockedProperty:he,getPropsFromInstance:function(e,n){for(var t={},o=0,r=n;o<r.length;o++){var a=r[o];t[a]=e.data[a]}return t},buildOptions:function(e,n,t,o,r,a,i){if(void 0===a&&(a=null),e===ce.page)return Object.assign({data:t,options:a},o,r);var c=n||{},s={};for(var l in c)if(Object.prototype.hasOwnProperty.call(c,l)){var u=c[l],f=void 0;if("string"==typeof u)f=String;else if("number"==typeof u)f=Number;else if("boolean"==typeof u)f=Boolean;else if(Array.isArray(u))f=Array;else{if("object"!=typeof u)throw new Error("不支持的 properties 类型: ".concat(l," - ").concat(typeof u));f=Object}s[l]={type:f,value:u}}return{properties:s,data:t,observers:i,lifetimes:o||{},methods:r||{}}}},se);var ve=M(null);function ge(){var e=K(ve);if(!e)throw new Error("请不要在组件内调用 hooks");return e}function ye(e,n,t,o){t||console.warn("useEventCall ".concat(e,": hooks 的 deps 参数为空，可能会导致性能问题"));var r=ge();r.ifServerRender&&r.handlersController.addHandler(e,{},(function(){}),!1),q((function(){var t=r.handlersController.addHandler(e,r.instance,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.apply(void 0,e)}),o);return t}),t)}function _e(e,n,t){var o,r=ge().platformConfig,a=r.pageEvents,i=r.componentEvents,c=r.blockedProperty;if(a.indexOf(e)>=0||i.indexOf(e)>=0)throw new Error("小程序 ".concat(e," 是生命周期相关的保留方法，不允许使用此种方法注册，请使用对应的 hooks: ").concat("use".concat((o=e)[0].toUpperCase()).concat(o.slice(1))));if(c.indexOf(e)>=0)throw new Error("不允许注册名为 ".concat(e," 的事件处理函数，这是小程序的保留属性，请换一个名称"));ye(e,n,t,!0)}function we(e,n,t){return void 0===n&&(n=!1),function(o,r){var a=ge();t&&function(e,n){if(e.name!==n){var t="期望的运行平台为 ".concat(n,"，但是当前平台配置为 ").concat(e.name,"，请检查是否加载了正确的平台配置");throw new Error(t)}if(!e.tellIfInThisPlatform())throw t="期望的运行平台为 ".concat(n,"，但是当前运行时环境不是 ").concat(n,"，请检查是否加载了正确的平台配置"),new Error(t)}(a.platformConfig,t);ye(e,o,null!=r?r:[],n)}}function be(){return ge().instance}var xe=be,ke=be,Ie="DANGER_ZONE_BYPASS_FUNCTION_CALL_WITH_DATA";function Ce(e,n,t,o){var r=G(n,o);return G(ve.Provider,{value:t,key:e,children:[r]},r)}function Ee(e,n,t,o,r){var a;void 0===n&&(n="");var i=null!=r?r:ie.alipay,c=me[i],s=c.pageEvents,l=c.componentEvents,u=c.buildOptions,d=c.componentLifeCycleToMount,p=c.componentLifeCycleToUnmount,h=c.pageLifeCycleToMount,m=c.pageLifeCycleToUnmount,v=c.getPropsFromInstance;(n=n||e.name)||console.warn("为了方便问题排查，请传入组件的 displayName 参数，或不要使用匿名函数组件 https://medium.com/@stevemao/do-not-use-anonymous-functions-to-construct-react-functional-components-c5408ec8f4c7");var g,y="[".concat(t,"/").concat(n||"(unnamed)","]"),_=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];J.apply(null,[y].concat(e))},w=function(e){if(e)throw e.message="".concat(y," ").concat(e.message),Y(e),e};if("component"===t&&(ee()===Z.UNKNOWN&&(g?X=g:"undefined"!=typeof my&&(X=my.canIUse("component2")?Z.VALID:Z.INVALID)),ee()===Z.INVALID))throw new Error("无法注册 ".concat(y,' 组件，因为当前小程序环境未开启 component2。配置入口在 mini.project.json : { "compileOptions": { "component2": true } }，或在 IDE 详情>项目配置中勾选'));var b,x="page"===t?s:l,k=Object.keys(o||{}),I={},C={};function E(){U((function(){var e=function(e){var n=[];for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var o=e[t];if(!o.unmounted)if(!o.elementInstance||o.pendingProps){var r=Ce(t,o.elementFn,o.appxContext,o.pendingProps);n.push(r),o.elementInstance=r,o.pendingProps=null}else n.push(o.elementInstance)}return G("div",{},n)}(C);b?b.update(e):b=function(e){var n=f.createElement("div");return F(e,n),{unmount:function(){F(R("div",{},"unmounted"),n)},update:function(e){F(e,n)},toString:function(){return n.innerHTML},dom:n}}(e)}))}var O=function(n){var t;if(n&&n[Ie])"string"==typeof(t=n[Ie])&&0===t.indexOf("%7B")&&(t=JSON.parse(decodeURIComponent(t)));else try{t=e.call(void 0,n)}catch(o){return o.message="渲染出错 ".concat(o.message),w(o)}if(void 0===t)_("函数组件没有返回渲染数据，请检查代码逻辑"),t={};else if("object"!=typeof t){var o=new Error("函数组件返回的渲染数据不合法，收到的类型为 ".concat(typeof t));return w(o)}var r=[],a=Object.keys(t)||[];for(var i in n)a.indexOf(i)>=0&&r.push(i);if(r.length>0){o=new Error("小程序自定义组件返回的渲染数据和 props 里的 key 重复：".concat(r.join(", ")));return w(o)}return function(e){void 0===e&&(e={});var n=ge();if(!n.instance)throw new Error("cannot get appx instance, failed to set data");n.ifServerRender&&n.instance.setData(e);var t=n.debugLog||function(){};if("object"!=typeof e)throw new Error("函数返回的数据必须是一个对象，收到了 ".concat(typeof e));q((function(){var o=n.instance,r=o[re]||[],a={},i=o.data||{};for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){if("function"==typeof e[c])throw new Error("".concat(c," - 不允许传入函数类型的数据"));i[c]&&i[c]===e[c]||(a[c]=e[c])}for(var s=0,l=Object.keys(i);s<l.length;s++)c=l[s],r.indexOf(c)>=0||Object.prototype.hasOwnProperty.call(e,c)||(a[c]=null);Object.keys(a).length>0&&(t("calling setData",a),o.setData(a))}),void 0)}(t||{}),G("div",{},"MINIFISH_PAGE_DOM_PLACEHOLDER")};function T(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=this,r=oe(o);if(C[r])throw new Error("duplicate id of appx instance, this might be a bug of minifish hooks. id: ".concat(r));var a=H(o,!1);o[re]=k,_("will mount react component");var i={};return"component"===t&&(i=v(o,k)),"page"===t&&(i={query:e[0]||{}}),C[r]={appxContext:a,appxId:r,elementFn:O,pendingProps:i,unmounted:!1,propKeys:k},E(),"page"===t?(_("页面（Page）已经 Mount，开始触发 onLoad"),a.handlersController.callHandlers(h,o,e)):(_("组件（Component）已经 Mount，开始触发 ".concat(d)),a.handlersController.callHandlers(d,o,e))}function P(e,n){var t=oe(e);C[t].pendingProps=n,E()}function L(){var e=oe(this);_("will unmount react element of ".concat(e)),C[e]||_("找不到 id 为 ".concat(e," 的实例，请检查是否开启了 component2 。这也可能是 Minifish 的 bug。")),C[e].unmounted=!0,E()}var N=new le(y),j=function(e){if(!e)throw new Error("ctx is required");var n=oe(e);return!C[n]},D=function(){return!0};if("page"===t)N.addHandler(h,j,T),N.addHandler(m,D,L);else if(N.addHandler(d,j,T),N.addHandler(p,D,L),i===ie.alipay)N.addHandler("deriveDataFromProps",D,(function(e){if(!this.props||this.props!==e)return P(this,e)}));else if(i===ie.wechat){var S=k.join(", ");_("将注册以下 key 的 props 更新：".concat(S)),I=Object.assign(((a={})[S]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return _("observer is being called",e),P(this,v(this,k))},a),I)}var H=function(e,n){return{instance:e,handlersController:N,ifServerRender:n,debugLog:_,platformConfig:me[i]}},M={},B={$id:"_minifish_hooks_pre_render_".concat(Math.random()),setData:function(e){M=Object.assign({},M||{},e)}},W=H(B,!0),V=Ce(B.$id,O,W,o||{});A(V),_("serverRendered with initData",M),N.lockHandlerNames();var $={},K={},z=N.getHandlersImplProxy();for(var Q in z)x.indexOf(Q)>=0?$[Q]=z[Q]:K[Q]=z[Q];var ne=u(t,o,M,$,K,null,I);return _("element options",ne),ne}export{ie as E,fe as a,ce as b,W as c,q as d,_e as e,Ee as f,we as g,V as h,Q as i,z as j,$ as k,pe as l,de as m,ke as n,xe as u};
